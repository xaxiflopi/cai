
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/imago.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.11">
    
    
      
        <title>MCP Servers - CAI</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#mcp-servers" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="CAI" class="md-header__button md-logo" aria-label="CAI" data-md-component="logo">
      
  <img src="../../../assets/imago.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CAI
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MCP Servers
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="CAI" class="md-nav__button md-logo" aria-label="CAI" data-md-component="logo">
      
  <img src="../../../assets/imago.png" alt="logo">

    </a>
    CAI
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quickstart
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_list_of_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    List of Models
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Start Building
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Start Building
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../running_agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../results/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Results
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Streaming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../handoffs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handoffs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tracing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ⚠️ Tracing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../guardrails/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guardrails
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../multi_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Orchestrating multiple agents
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_1" >
        
          
          <label class="md-nav__link" for="__nav_7_2_1" id="__nav_7_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_1">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Runner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tool/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../result/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Results
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stream_events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Streaming events
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../handoffs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handoffs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lifecycle
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../items/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Items
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../run_context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Run context
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Exceptions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guardrail/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guardrails
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../model_settings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model settings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agent_output/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent output
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../function_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Function schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/interface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model interface
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/openai_chatcompletions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAI Chat Completions model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/openai_responses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenAI Responses model
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2_2" id="__nav_7_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Extensions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2_2">
            <span class="md-nav__icon md-icon"></span>
            Extensions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extensions/handoff_filters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handoff filters
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extensions/handoff_prompt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handoff prompt
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    More About CAI
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            More About CAI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_find_us/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Find Us
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../cai_citation_and_acknowledgments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Citation & Acknowledgments
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server" class="md-nav__link">
    <span class="md-ellipsis">
      server
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServer" class="md-nav__link">
    <span class="md-ellipsis">
      MCPServer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCPServer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServer.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServer.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServer.cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServer.list_tools" class="md-nav__link">
    <span class="md-ellipsis">
      list_tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServer.call_tool" class="md-nav__link">
    <span class="md-ellipsis">
      call_tool
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdioParams" class="md-nav__link">
    <span class="md-ellipsis">
      MCPServerStdioParams
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCPServerStdioParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdioParams.command" class="md-nav__link">
    <span class="md-ellipsis">
      command
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdioParams.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdioParams.env" class="md-nav__link">
    <span class="md-ellipsis">
      env
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdioParams.cwd" class="md-nav__link">
    <span class="md-ellipsis">
      cwd
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdioParams.encoding" class="md-nav__link">
    <span class="md-ellipsis">
      encoding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdioParams.encoding_error_handler" class="md-nav__link">
    <span class="md-ellipsis">
      encoding_error_handler
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio" class="md-nav__link">
    <span class="md-ellipsis">
      MCPServerStdio
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCPServerStdio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.create_streams" class="md-nav__link">
    <span class="md-ellipsis">
      create_streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.list_tools" class="md-nav__link">
    <span class="md-ellipsis">
      list_tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.call_tool" class="md-nav__link">
    <span class="md-ellipsis">
      call_tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerStdio.invalidate_tools_cache" class="md-nav__link">
    <span class="md-ellipsis">
      invalidate_tools_cache
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSseParams" class="md-nav__link">
    <span class="md-ellipsis">
      MCPServerSseParams
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCPServerSseParams">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSseParams.url" class="md-nav__link">
    <span class="md-ellipsis">
      url
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSseParams.headers" class="md-nav__link">
    <span class="md-ellipsis">
      headers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSseParams.timeout" class="md-nav__link">
    <span class="md-ellipsis">
      timeout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSseParams.sse_read_timeout" class="md-nav__link">
    <span class="md-ellipsis">
      sse_read_timeout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse" class="md-nav__link">
    <span class="md-ellipsis">
      MCPServerSse
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MCPServerSse">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.create_streams" class="md-nav__link">
    <span class="md-ellipsis">
      create_streams
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      cleanup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.connect" class="md-nav__link">
    <span class="md-ellipsis">
      connect
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.list_tools" class="md-nav__link">
    <span class="md-ellipsis">
      list_tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.call_tool" class="md-nav__link">
    <span class="md-ellipsis">
      call_tool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cai.sdk.agents.mcp.server.MCPServerSse.invalidate_tools_cache" class="md-nav__link">
    <span class="md-ellipsis">
      invalidate_tools_cache
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="mcp-servers"><code>MCP Servers</code></h1>


<div class="doc doc-object doc-module">



<a id="cai.sdk.agents.mcp.server"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="cai.sdk.agents.mcp.server.MCPServer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MCPServer</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base class for Model Context Protocol servers.</p>







              <details class="quote">
                <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-21"><span class="k">class</span><span class="w"> </span><span class="nc">MCPServer</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="__span-0-22"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for Model Context Protocol servers.&quot;&quot;&quot;</span>
</span><span id="__span-0-23">
</span><span id="__span-0-24">    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-25">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-26"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Connect to the server. For example, this might mean spawning a subprocess or</span>
</span><span id="__span-0-27"><span class="sd">        opening a network connection. The server is expected to remain connected until</span>
</span><span id="__span-0-28"><span class="sd">        `cleanup()` is called.</span>
</span><span id="__span-0-29"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-30">        <span class="k">pass</span>
</span><span id="__span-0-31">
</span><span id="__span-0-32">    <span class="nd">@property</span>
</span><span id="__span-0-33">    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-34">    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-35"><span class="w">        </span><span class="sd">&quot;&quot;&quot;A readable name for the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-36">        <span class="k">pass</span>
</span><span id="__span-0-37">
</span><span id="__span-0-38">    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-39">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-40"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleanup the server. For example, this might mean closing a subprocess or</span>
</span><span id="__span-0-41"><span class="sd">        closing a network connection.</span>
</span><span id="__span-0-42"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-43">        <span class="k">pass</span>
</span><span id="__span-0-44">
</span><span id="__span-0-45">    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-46">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MCPTool</span><span class="p">]:</span>
</span><span id="__span-0-47"><span class="w">        </span><span class="sd">&quot;&quot;&quot;List the tools available on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-48">        <span class="k">pass</span>
</span><span id="__span-0-49">
</span><span id="__span-0-50">    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-51">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallToolResult</span><span class="p">:</span>
</span><span id="__span-0-52"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Invoke a tool on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-53">        <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServer.name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>A readable name for the server.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServer.connect" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">connect</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">connect</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Connect to the server. For example, this might mean spawning a subprocess or
opening a network connection. The server is expected to remain connected until
<code>cleanup()</code> is called.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-24"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-25"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-26"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Connect to the server. For example, this might mean spawning a subprocess or</span>
</span><span id="__span-0-27"><span class="sd">    opening a network connection. The server is expected to remain connected until</span>
</span><span id="__span-0-28"><span class="sd">    `cleanup()` is called.</span>
</span><span id="__span-0-29"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-30">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServer.cleanup" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">cleanup</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">cleanup</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Cleanup the server. For example, this might mean closing a subprocess or
closing a network connection.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-38"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-39"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-40"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cleanup the server. For example, this might mean closing a subprocess or</span>
</span><span id="__span-0-41"><span class="sd">    closing a network connection.</span>
</span><span id="__span-0-42"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-43">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServer.list_tools" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_tools</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">list_tools</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="mcp.Tool">Tool</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>List the tools available on the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-45"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-46"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MCPTool</span><span class="p">]:</span>
</span><span id="__span-0-47"><span class="w">    </span><span class="sd">&quot;&quot;&quot;List the tools available on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-48">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServer.call_tool" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">call_tool</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">call_tool</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">tool_name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="mcp.types.CallToolResult">CallToolResult</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Invoke a tool on the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-50"><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="__span-0-51"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallToolResult</span><span class="p">:</span>
</span><span id="__span-0-52"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invoke a tool on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-53">    <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cai.sdk.agents.mcp.server.MCPServerStdioParams" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MCPServerStdioParams</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing_extensions.TypedDict">TypedDict</span></code></p>


        <p>Mirrors <code>mcp.client.stdio.StdioServerParameters</code>, but lets you pass params without another
import.</p>







              <details class="quote">
                <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-162"><span class="k">class</span><span class="w"> </span><span class="nc">MCPServerStdioParams</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
</span><span id="__span-0-163"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mirrors `mcp.client.stdio.StdioServerParameters`, but lets you pass params without another</span>
</span><span id="__span-0-164"><span class="sd">    import.</span>
</span><span id="__span-0-165"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-166">
</span><span id="__span-0-167">    <span class="n">command</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-0-168"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The executable to run to start the server. For example, `python` or `node`.&quot;&quot;&quot;</span>
</span><span id="__span-0-169">
</span><span id="__span-0-170">    <span class="n">args</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
</span><span id="__span-0-171"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Command line args to pass to the `command` executable. For example, `[&#39;foo.py&#39;]` or</span>
</span><span id="__span-0-172"><span class="sd">    `[&#39;server.js&#39;, &#39;--port&#39;, &#39;8080&#39;]`.&quot;&quot;&quot;</span>
</span><span id="__span-0-173">
</span><span id="__span-0-174">    <span class="n">env</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
</span><span id="__span-0-175"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The environment variables to set for the server. .&quot;&quot;&quot;</span>
</span><span id="__span-0-176">
</span><span id="__span-0-177">    <span class="n">cwd</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">]</span>
</span><span id="__span-0-178"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The working directory to use when spawning the process.&quot;&quot;&quot;</span>
</span><span id="__span-0-179">
</span><span id="__span-0-180">    <span class="n">encoding</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span><span id="__span-0-181"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The text encoding used when sending/receiving messages to the server. Defaults to `utf-8`.&quot;&quot;&quot;</span>
</span><span id="__span-0-182">
</span><span id="__span-0-183">    <span class="n">encoding_error_handler</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;strict&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">]]</span>
</span><span id="__span-0-184"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The text encoding error handler. Defaults to `strict`.</span>
</span><span id="__span-0-185">
</span><span id="__span-0-186"><span class="sd">    See https://docs.python.org/3/library/codecs.html#codec-base-classes for</span>
</span><span id="__span-0-187"><span class="sd">    explanations of possible values.</span>
</span><span id="__span-0-188"><span class="sd">    &quot;&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerStdioParams.command" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">command</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">command</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The executable to run to start the server. For example, <code>python</code> or <code>node</code>.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerStdioParams.args" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">args</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">args</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span><span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Command line args to pass to the <code>command</code> executable. For example, <code>['foo.py']</code> or
<code>['server.js', '--port', '8080']</code>.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerStdioParams.env" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">env</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">env</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="str">str</span></span><span class="p">]]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The environment variables to set for the server. .</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerStdioParams.cwd" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">cwd</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">cwd</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="pathlib.Path">Path</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The working directory to use when spawning the process.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerStdioParams.encoding" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">encoding</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">encoding</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The text encoding used when sending/receiving messages to the server. Defaults to <code>utf-8</code>.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerStdioParams.encoding_error_handler" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">encoding_error_handler</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">encoding_error_handler</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span>
</span><span id="__span-0-2">    <span class="n"><span title="typing.Literal">Literal</span></span><span class="p">[</span><span class="s2">&quot;strict&quot;</span><span class="p">,</span> <span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="s2">&quot;replace&quot;</span><span class="p">]</span>
</span><span id="__span-0-3"><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The text encoding error handler. Defaults to <code>strict</code>.</p>
<p>See https://docs.python.org/3/library/codecs.html#codec-base-classes for
explanations of possible values.</p>

    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cai.sdk.agents.mcp.server.MCPServerStdio" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MCPServerStdio</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="cai.sdk.agents.mcp.server._MCPServerWithClientSession">_MCPServerWithClientSession</span></code></p>


        <p>MCP server implementation that uses the stdio transport. See the [spec]
(https://spec.modelcontextprotocol.io/specification/2024-11-05/basic/transports/#stdio) for
details.</p>







              <details class="quote">
                <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-191"><span class="k">class</span><span class="w"> </span><span class="nc">MCPServerStdio</span><span class="p">(</span><span class="n">_MCPServerWithClientSession</span><span class="p">):</span>
</span><span id="__span-0-192"><span class="w">    </span><span class="sd">&quot;&quot;&quot;MCP server implementation that uses the stdio transport. See the [spec]</span>
</span><span id="__span-0-193"><span class="sd">    (https://spec.modelcontextprotocol.io/specification/2024-11-05/basic/transports/#stdio) for</span>
</span><span id="__span-0-194"><span class="sd">    details.</span>
</span><span id="__span-0-195"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-196">
</span><span id="__span-0-197">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-198">        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-199">        <span class="n">params</span><span class="p">:</span> <span class="n">MCPServerStdioParams</span><span class="p">,</span>
</span><span id="__span-0-200">        <span class="n">cache_tools_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-201">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-202">    <span class="p">):</span>
</span><span id="__span-0-203"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new MCP server based on the stdio transport.</span>
</span><span id="__span-0-204">
</span><span id="__span-0-205"><span class="sd">        Args:</span>
</span><span id="__span-0-206"><span class="sd">            params: The params that configure the server. This includes the command to run to</span>
</span><span id="__span-0-207"><span class="sd">                start the server, the args to pass to the command, the environment variables to</span>
</span><span id="__span-0-208"><span class="sd">                set for the server, the working directory to use when spawning the process, and</span>
</span><span id="__span-0-209"><span class="sd">                the text encoding used when sending/receiving messages to the server.</span>
</span><span id="__span-0-210"><span class="sd">            cache_tools_list: Whether to cache the tools list. If `True`, the tools list will be</span>
</span><span id="__span-0-211"><span class="sd">                cached and only fetched from the server once. If `False`, the tools list will be</span>
</span><span id="__span-0-212"><span class="sd">                fetched from the server on each call to `list_tools()`. The cache can be</span>
</span><span id="__span-0-213"><span class="sd">                invalidated by calling `invalidate_tools_cache()`. You should set this to `True`</span>
</span><span id="__span-0-214"><span class="sd">                if you know the server will not change its tools list, because it can drastically</span>
</span><span id="__span-0-215"><span class="sd">                improve latency (by avoiding a round-trip to the server every time).</span>
</span><span id="__span-0-216"><span class="sd">            name: A readable name for the server. If not provided, we&#39;ll create one from the</span>
</span><span id="__span-0-217"><span class="sd">                command.</span>
</span><span id="__span-0-218"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-219">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cache_tools_list</span><span class="p">)</span>
</span><span id="__span-0-220">
</span><span id="__span-0-221">        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">StdioServerParameters</span><span class="p">(</span>
</span><span id="__span-0-222">            <span class="n">command</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">],</span>
</span><span id="__span-0-223">            <span class="n">args</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="__span-0-224">            <span class="n">env</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">),</span>
</span><span id="__span-0-225">            <span class="n">cwd</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cwd&quot;</span><span class="p">),</span>
</span><span id="__span-0-226">            <span class="n">encoding</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
</span><span id="__span-0-227">            <span class="n">encoding_error_handler</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_error_handler&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
</span><span id="__span-0-228">        <span class="p">)</span>
</span><span id="__span-0-229">
</span><span id="__span-0-230">        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;stdio: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-231">
</span><span id="__span-0-232">    <span class="k">def</span><span class="w"> </span><span class="nf">create_streams</span><span class="p">(</span>
</span><span id="__span-0-233">        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-234">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AbstractAsyncContextManager</span><span class="p">[</span>
</span><span id="__span-0-235">        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="__span-0-236">            <span class="n">MemoryObjectReceiveStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span> <span class="o">|</span> <span class="ne">Exception</span><span class="p">],</span>
</span><span id="__span-0-237">            <span class="n">MemoryObjectSendStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span><span class="p">],</span>
</span><span id="__span-0-238">        <span class="p">]</span>
</span><span id="__span-0-239">    <span class="p">]:</span>
</span><span id="__span-0-240"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the streams for the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-241">        <span class="k">return</span> <span class="n">stdio_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-0-242">
</span><span id="__span-0-243">    <span class="nd">@property</span>
</span><span id="__span-0-244">    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-245"><span class="w">        </span><span class="sd">&quot;&quot;&quot;A readable name for the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-246">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span></code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>A readable name for the server.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="nf">params</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="MCPServerStdioParams (cai.sdk.agents.mcp.server.MCPServerStdioParams)" href="#cai.sdk.agents.mcp.server.MCPServerStdioParams">MCPServerStdioParams</a></span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">cache_tools_list</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new MCP server based on the stdio transport.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="MCPServerStdioParams (cai.sdk.agents.mcp.server.MCPServerStdioParams)" href="#cai.sdk.agents.mcp.server.MCPServerStdioParams">MCPServerStdioParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The params that configure the server. This includes the command to run to
start the server, the args to pass to the command, the environment variables to
set for the server, the working directory to use when spawning the process, and
the text encoding used when sending/receiving messages to the server.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache_tools_list</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to cache the tools list. If <code>True</code>, the tools list will be
cached and only fetched from the server once. If <code>False</code>, the tools list will be
fetched from the server on each call to <code>list_tools()</code>. The cache can be
invalidated by calling <code>invalidate_tools_cache()</code>. You should set this to <code>True</code>
if you know the server will not change its tools list, because it can drastically
improve latency (by avoiding a round-trip to the server every time).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A readable name for the server. If not provided, we'll create one from the
command.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-197"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-198">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-199">    <span class="n">params</span><span class="p">:</span> <span class="n">MCPServerStdioParams</span><span class="p">,</span>
</span><span id="__span-0-200">    <span class="n">cache_tools_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-201">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-202"><span class="p">):</span>
</span><span id="__span-0-203"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new MCP server based on the stdio transport.</span>
</span><span id="__span-0-204">
</span><span id="__span-0-205"><span class="sd">    Args:</span>
</span><span id="__span-0-206"><span class="sd">        params: The params that configure the server. This includes the command to run to</span>
</span><span id="__span-0-207"><span class="sd">            start the server, the args to pass to the command, the environment variables to</span>
</span><span id="__span-0-208"><span class="sd">            set for the server, the working directory to use when spawning the process, and</span>
</span><span id="__span-0-209"><span class="sd">            the text encoding used when sending/receiving messages to the server.</span>
</span><span id="__span-0-210"><span class="sd">        cache_tools_list: Whether to cache the tools list. If `True`, the tools list will be</span>
</span><span id="__span-0-211"><span class="sd">            cached and only fetched from the server once. If `False`, the tools list will be</span>
</span><span id="__span-0-212"><span class="sd">            fetched from the server on each call to `list_tools()`. The cache can be</span>
</span><span id="__span-0-213"><span class="sd">            invalidated by calling `invalidate_tools_cache()`. You should set this to `True`</span>
</span><span id="__span-0-214"><span class="sd">            if you know the server will not change its tools list, because it can drastically</span>
</span><span id="__span-0-215"><span class="sd">            improve latency (by avoiding a round-trip to the server every time).</span>
</span><span id="__span-0-216"><span class="sd">        name: A readable name for the server. If not provided, we&#39;ll create one from the</span>
</span><span id="__span-0-217"><span class="sd">            command.</span>
</span><span id="__span-0-218"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-219">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cache_tools_list</span><span class="p">)</span>
</span><span id="__span-0-220">
</span><span id="__span-0-221">    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">StdioServerParameters</span><span class="p">(</span>
</span><span id="__span-0-222">        <span class="n">command</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">],</span>
</span><span id="__span-0-223">        <span class="n">args</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="__span-0-224">        <span class="n">env</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">),</span>
</span><span id="__span-0-225">        <span class="n">cwd</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cwd&quot;</span><span class="p">),</span>
</span><span id="__span-0-226">        <span class="n">encoding</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
</span><span id="__span-0-227">        <span class="n">encoding_error_handler</span><span class="o">=</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_error_handler&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
</span><span id="__span-0-228">    <span class="p">)</span>
</span><span id="__span-0-229">
</span><span id="__span-0-230">    <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;stdio: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">command</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.create_streams" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_streams</span>


</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">create_streams</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="contextlib.AbstractAsyncContextManager">AbstractAsyncContextManager</span></span><span class="p">[</span>
</span><span id="__span-0-2">    <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span>
</span><span id="__span-0-3">        <span class="n"><span title="anyio.streams.memory.MemoryObjectReceiveStream">MemoryObjectReceiveStream</span></span><span class="p">[</span>
</span><span id="__span-0-4">            <span class="n"><span title="mcp.types.JSONRPCMessage">JSONRPCMessage</span></span> <span class="o">|</span> <span class="n"><span title="Exception">Exception</span></span>
</span><span id="__span-0-5">        <span class="p">],</span>
</span><span id="__span-0-6">        <span class="n"><span title="anyio.streams.memory.MemoryObjectSendStream">MemoryObjectSendStream</span></span><span class="p">[</span><span class="n"><span title="mcp.types.JSONRPCMessage">JSONRPCMessage</span></span><span class="p">],</span>
</span><span id="__span-0-7">    <span class="p">]</span>
</span><span id="__span-0-8"><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create the streams for the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-232"><span class="k">def</span><span class="w"> </span><span class="nf">create_streams</span><span class="p">(</span>
</span><span id="__span-0-233">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-234"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AbstractAsyncContextManager</span><span class="p">[</span>
</span><span id="__span-0-235">    <span class="nb">tuple</span><span class="p">[</span>
</span><span id="__span-0-236">        <span class="n">MemoryObjectReceiveStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span> <span class="o">|</span> <span class="ne">Exception</span><span class="p">],</span>
</span><span id="__span-0-237">        <span class="n">MemoryObjectSendStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span><span class="p">],</span>
</span><span id="__span-0-238">    <span class="p">]</span>
</span><span id="__span-0-239"><span class="p">]:</span>
</span><span id="__span-0-240"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the streams for the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-241">    <span class="k">return</span> <span class="n">stdio_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.connect" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">connect</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">connect</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Connect to the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-101"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-102"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Connect to the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-103">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-104">        <span class="n">transport</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_async_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_streams</span><span class="p">())</span>
</span><span id="__span-0-105">        <span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">transport</span>
</span><span id="__span-0-106">        <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_async_context</span><span class="p">(</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">write</span><span class="p">))</span>
</span><span id="__span-0-107">        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="__span-0-108">        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
</span><span id="__span-0-109">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-110">        <span class="c1"># Only log connection errors at debug level</span>
</span><span id="__span-0-111">        <span class="n">error_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-0-112">        <span class="n">error_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="__span-0-113">        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;connection&quot;</span> <span class="ow">in</span> <span class="n">error_str</span> <span class="ow">or</span> 
</span><span id="__span-0-114">            <span class="s2">&quot;refused&quot;</span> <span class="ow">in</span> <span class="n">error_str</span> <span class="ow">or</span> 
</span><span id="__span-0-115">            <span class="s2">&quot;taskgroup&quot;</span> <span class="ow">in</span> <span class="n">error_str</span> <span class="ow">or</span>
</span><span id="__span-0-116">            <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;ExceptionGroup&quot;</span><span class="p">):</span>
</span><span id="__span-0-117">            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected connection error during MCP server init: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-118">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-119">            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error initializing MCP server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-120">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="__span-0-121">        <span class="k">raise</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.cleanup" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">cleanup</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">cleanup</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Cleanup the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-146"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-147"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cleanup the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-148">    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_lock</span><span class="p">:</span>
</span><span id="__span-0-149">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-150">            <span class="c1"># Suppress async generator warnings during cleanup</span>
</span><span id="__span-0-151">            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="__span-0-152">                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*asynchronous generator.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-153">                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*was never awaited.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-154">                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">aclose</span><span class="p">()</span>
</span><span id="__span-0-155">                <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-156">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-157">            <span class="c1"># Only log errors that aren&#39;t expected during cleanup</span>
</span><span id="__span-0-158">            <span class="k">if</span> <span class="s2">&quot;ClosedResourceError&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;async generator&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span><span id="__span-0-159">                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected cleanup error (can be ignored): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.list_tools" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_tools</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">list_tools</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="mcp.Tool">Tool</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>List the tools available on the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-123"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MCPTool</span><span class="p">]:</span>
</span><span id="__span-0-124"><span class="w">    </span><span class="sd">&quot;&quot;&quot;List the tools available on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-125">    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
</span><span id="__span-0-126">        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Server not initialized. Make sure you call `connect()` first.&quot;</span><span class="p">)</span>
</span><span id="__span-0-127">
</span><span id="__span-0-128">    <span class="c1"># Return from cache if caching is enabled, we have tools, and the cache is not dirty</span>
</span><span id="__span-0-129">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_tools_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirty</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span><span class="p">:</span>
</span><span id="__span-0-130">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span>
</span><span id="__span-0-131">
</span><span id="__span-0-132">    <span class="c1"># Reset the cache dirty to False</span>
</span><span id="__span-0-133">    <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirty</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-134">
</span><span id="__span-0-135">    <span class="c1"># Fetch the tools from the server</span>
</span><span id="__span-0-136">    <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">list_tools</span><span class="p">())</span><span class="o">.</span><span class="n">tools</span>
</span><span id="__span-0-137">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.call_tool" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">call_tool</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">call_tool</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">tool_name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="mcp.types.CallToolResult">CallToolResult</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Invoke a tool on the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-139"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallToolResult</span><span class="p">:</span>
</span><span id="__span-0-140"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invoke a tool on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-141">    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
</span><span id="__span-0-142">        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Server not initialized. Make sure you call `connect()` first.&quot;</span><span class="p">)</span>
</span><span id="__span-0-143">
</span><span id="__span-0-144">    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerStdio.invalidate_tools_cache" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">invalidate_tools_cache</span>


</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">invalidate_tools_cache</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Invalidate the tools cache.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-97"><span class="k">def</span><span class="w"> </span><span class="nf">invalidate_tools_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-98"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invalidate the tools cache.&quot;&quot;&quot;</span>
</span><span id="__span-0-99">    <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirty</span> <span class="o">=</span> <span class="kc">True</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cai.sdk.agents.mcp.server.MCPServerSseParams" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MCPServerSseParams</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing_extensions.TypedDict">TypedDict</span></code></p>


        <p>Mirrors the params in<code>mcp.client.sse.sse_client</code>.</p>







              <details class="quote">
                <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-249"><span class="k">class</span><span class="w"> </span><span class="nc">MCPServerSseParams</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
</span><span id="__span-0-250"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mirrors the params in`mcp.client.sse.sse_client`.&quot;&quot;&quot;</span>
</span><span id="__span-0-251">
</span><span id="__span-0-252">    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-0-253"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The URL of the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-254">
</span><span id="__span-0-255">    <span class="n">headers</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span>
</span><span id="__span-0-256"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The headers to send to the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-257">
</span><span id="__span-0-258">    <span class="n">timeout</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</span><span id="__span-0-259"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The timeout for the HTTP request. Defaults to 5 seconds.&quot;&quot;&quot;</span>
</span><span id="__span-0-260">
</span><span id="__span-0-261">    <span class="n">sse_read_timeout</span><span class="p">:</span> <span class="n">NotRequired</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</span><span id="__span-0-262"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The timeout for the SSE connection, in seconds. Defaults to 5 minutes.&quot;&quot;&quot;</span>
</span></code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerSseParams.url" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">url</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">url</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The URL of the server.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerSseParams.headers" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">headers</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">headers</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="str">str</span></span><span class="p">]]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The headers to send to the server.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerSseParams.timeout" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">timeout</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">timeout</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span><span class="n"><span title="float">float</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The timeout for the HTTP request. Defaults to 5 seconds.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerSseParams.sse_read_timeout" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">sse_read_timeout</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">sse_read_timeout</span><span class="p">:</span> <span class="n"><span title="typing_extensions.NotRequired">NotRequired</span></span><span class="p">[</span><span class="n"><span title="float">float</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>The timeout for the SSE connection, in seconds. Defaults to 5 minutes.</p>

    </div>

</div>





  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="cai.sdk.agents.mcp.server.MCPServerSse" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MCPServerSse</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="cai.sdk.agents.mcp.server._MCPServerWithClientSession">_MCPServerWithClientSession</span></code></p>


        <p>MCP server implementation that uses the HTTP with SSE transport. See the [spec]
(https://spec.modelcontextprotocol.io/specification/2024-11-05/basic/transports/#http-with-sse)
for details.</p>







              <details class="quote">
                <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
                <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-265"><span class="k">class</span><span class="w"> </span><span class="nc">MCPServerSse</span><span class="p">(</span><span class="n">_MCPServerWithClientSession</span><span class="p">):</span>
</span><span id="__span-0-266"><span class="w">    </span><span class="sd">&quot;&quot;&quot;MCP server implementation that uses the HTTP with SSE transport. See the [spec]</span>
</span><span id="__span-0-267"><span class="sd">    (https://spec.modelcontextprotocol.io/specification/2024-11-05/basic/transports/#http-with-sse)</span>
</span><span id="__span-0-268"><span class="sd">    for details.</span>
</span><span id="__span-0-269"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-270">
</span><span id="__span-0-271">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-272">        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-273">        <span class="n">params</span><span class="p">:</span> <span class="n">MCPServerSseParams</span><span class="p">,</span>
</span><span id="__span-0-274">        <span class="n">cache_tools_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-275">        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-276">    <span class="p">):</span>
</span><span id="__span-0-277"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new MCP server based on the HTTP with SSE transport.</span>
</span><span id="__span-0-278">
</span><span id="__span-0-279"><span class="sd">        Args:</span>
</span><span id="__span-0-280"><span class="sd">            params: The params that configure the server. This includes the URL of the server,</span>
</span><span id="__span-0-281"><span class="sd">                the headers to send to the server, the timeout for the HTTP request, and the</span>
</span><span id="__span-0-282"><span class="sd">                timeout for the SSE connection.</span>
</span><span id="__span-0-283">
</span><span id="__span-0-284"><span class="sd">            cache_tools_list: Whether to cache the tools list. If `True`, the tools list will be</span>
</span><span id="__span-0-285"><span class="sd">                cached and only fetched from the server once. If `False`, the tools list will be</span>
</span><span id="__span-0-286"><span class="sd">                fetched from the server on each call to `list_tools()`. The cache can be</span>
</span><span id="__span-0-287"><span class="sd">                invalidated by calling `invalidate_tools_cache()`. You should set this to `True`</span>
</span><span id="__span-0-288"><span class="sd">                if you know the server will not change its tools list, because it can drastically</span>
</span><span id="__span-0-289"><span class="sd">                improve latency (by avoiding a round-trip to the server every time).</span>
</span><span id="__span-0-290">
</span><span id="__span-0-291"><span class="sd">            name: A readable name for the server. If not provided, we&#39;ll create one from the</span>
</span><span id="__span-0-292"><span class="sd">                URL.</span>
</span><span id="__span-0-293"><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="__span-0-294">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cache_tools_list</span><span class="p">)</span>
</span><span id="__span-0-295">
</span><span id="__span-0-296">        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="__span-0-297">        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;sse: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-298">
</span><span id="__span-0-299">    <span class="k">def</span><span class="w"> </span><span class="nf">create_streams</span><span class="p">(</span>
</span><span id="__span-0-300">        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-301">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AbstractAsyncContextManager</span><span class="p">[</span>
</span><span id="__span-0-302">        <span class="nb">tuple</span><span class="p">[</span>
</span><span id="__span-0-303">            <span class="n">MemoryObjectReceiveStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span> <span class="o">|</span> <span class="ne">Exception</span><span class="p">],</span>
</span><span id="__span-0-304">            <span class="n">MemoryObjectSendStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span><span class="p">],</span>
</span><span id="__span-0-305">        <span class="p">]</span>
</span><span id="__span-0-306">    <span class="p">]:</span>
</span><span id="__span-0-307"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create the streams for the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-308">        <span class="k">return</span> <span class="n">sse_client</span><span class="p">(</span>
</span><span id="__span-0-309">            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
</span><span id="__span-0-310">            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="__span-0-311">            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="__span-0-312">            <span class="n">sse_read_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sse_read_timeout&quot;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="__span-0-313">        <span class="p">)</span>
</span><span id="__span-0-314">
</span><span id="__span-0-315">    <span class="nd">@property</span>
</span><span id="__span-0-316">    <span class="k">def</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-317"><span class="w">        </span><span class="sd">&quot;&quot;&quot;A readable name for the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-318">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
</span><span id="__span-0-319">
</span><span id="__span-0-320">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-321"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleanup the SSE server with special handling for async generators.&quot;&quot;&quot;</span>
</span><span id="__span-0-322">        <span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="__span-0-323">        <span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-0-324">
</span><span id="__span-0-325">        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_lock</span><span class="p">:</span>
</span><span id="__span-0-326">            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-327">                <span class="c1"># For SSE servers, we need to handle cleanup more carefully</span>
</span><span id="__span-0-328">                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="__span-0-329">                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="__span-0-330">                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*asynchronous generator.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-331">                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*didn&#39;t stop after athrow.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-332">                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*cancel scope.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-333">
</span><span id="__span-0-334">                    <span class="c1"># Try to close gracefully with a short timeout</span>
</span><span id="__span-0-335">                    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-336">                        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">aclose</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-337">                    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
</span><span id="__span-0-338">                        <span class="c1"># Expected for SSE connections</span>
</span><span id="__span-0-339">                        <span class="k">pass</span>
</span><span id="__span-0-340">                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-341">                        <span class="c1"># Ignore other cleanup errors for SSE</span>
</span><span id="__span-0-342">                        <span class="k">pass</span>
</span><span id="__span-0-343">
</span><span id="__span-0-344">                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-345">            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-346">                <span class="c1"># Silently ignore all cleanup errors for SSE</span>
</span><span id="__span-0-347">                <span class="k">pass</span>
</span><span id="__span-0-348">
</span><span id="__span-0-349">    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-350"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleanup the SSE server with special handling for async generators.&quot;&quot;&quot;</span>
</span><span id="__span-0-351">        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_lock</span><span class="p">:</span>
</span><span id="__span-0-352">            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-353">                <span class="c1"># For SSE connections, we need to handle cleanup differently</span>
</span><span id="__span-0-354">                <span class="c1"># to avoid async generator warnings</span>
</span><span id="__span-0-355">                <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="__span-0-356">                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="__span-0-357">                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*asynchronous generator.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-358">                    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*was never awaited.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-359">
</span><span id="__span-0-360">                    <span class="c1"># Try a quick cleanup with a short timeout</span>
</span><span id="__span-0-361">                    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-362">                        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">aclose</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-363">                    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
</span><span id="__span-0-364">                        <span class="c1"># Expected for SSE connections</span>
</span><span id="__span-0-365">                        <span class="k">pass</span>
</span><span id="__span-0-366">                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-367">                        <span class="c1"># Ignore any other errors during SSE cleanup</span>
</span><span id="__span-0-368">                        <span class="k">pass</span>
</span><span id="__span-0-369">                    <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-0-370">                        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-371">            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-372">                <span class="c1"># Silently ignore all errors for SSE cleanup</span>
</span><span id="__span-0-373">                <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="n">name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>A readable name for the server.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="nf">params</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="MCPServerSseParams (cai.sdk.agents.mcp.server.MCPServerSseParams)" href="#cai.sdk.agents.mcp.server.MCPServerSseParams">MCPServerSseParams</a></span><span class="p">,</span>
</span><span id="__span-0-3">    <span class="n">cache_tools_list</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-4">    <span class="n">name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-5"><span class="p">)</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a new MCP server based on the HTTP with SSE transport.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="MCPServerSseParams (cai.sdk.agents.mcp.server.MCPServerSseParams)" href="#cai.sdk.agents.mcp.server.MCPServerSseParams">MCPServerSseParams</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The params that configure the server. This includes the URL of the server,
the headers to send to the server, the timeout for the HTTP request, and the
timeout for the SSE connection.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache_tools_list</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to cache the tools list. If <code>True</code>, the tools list will be
cached and only fetched from the server once. If <code>False</code>, the tools list will be
fetched from the server on each call to <code>list_tools()</code>. The cache can be
invalidated by calling <code>invalidate_tools_cache()</code>. You should set this to <code>True</code>
if you know the server will not change its tools list, because it can drastically
improve latency (by avoiding a round-trip to the server every time).</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A readable name for the server. If not provided, we'll create one from the
URL.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-271"><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="__span-0-272">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-273">    <span class="n">params</span><span class="p">:</span> <span class="n">MCPServerSseParams</span><span class="p">,</span>
</span><span id="__span-0-274">    <span class="n">cache_tools_list</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-275">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-276"><span class="p">):</span>
</span><span id="__span-0-277"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a new MCP server based on the HTTP with SSE transport.</span>
</span><span id="__span-0-278">
</span><span id="__span-0-279"><span class="sd">    Args:</span>
</span><span id="__span-0-280"><span class="sd">        params: The params that configure the server. This includes the URL of the server,</span>
</span><span id="__span-0-281"><span class="sd">            the headers to send to the server, the timeout for the HTTP request, and the</span>
</span><span id="__span-0-282"><span class="sd">            timeout for the SSE connection.</span>
</span><span id="__span-0-283">
</span><span id="__span-0-284"><span class="sd">        cache_tools_list: Whether to cache the tools list. If `True`, the tools list will be</span>
</span><span id="__span-0-285"><span class="sd">            cached and only fetched from the server once. If `False`, the tools list will be</span>
</span><span id="__span-0-286"><span class="sd">            fetched from the server on each call to `list_tools()`. The cache can be</span>
</span><span id="__span-0-287"><span class="sd">            invalidated by calling `invalidate_tools_cache()`. You should set this to `True`</span>
</span><span id="__span-0-288"><span class="sd">            if you know the server will not change its tools list, because it can drastically</span>
</span><span id="__span-0-289"><span class="sd">            improve latency (by avoiding a round-trip to the server every time).</span>
</span><span id="__span-0-290">
</span><span id="__span-0-291"><span class="sd">        name: A readable name for the server. If not provided, we&#39;ll create one from the</span>
</span><span id="__span-0-292"><span class="sd">            URL.</span>
</span><span id="__span-0-293"><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="__span-0-294">    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">cache_tools_list</span><span class="p">)</span>
</span><span id="__span-0-295">
</span><span id="__span-0-296">    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
</span><span id="__span-0-297">    <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">&quot;sse: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.create_streams" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">create_streams</span>


</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">create_streams</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="contextlib.AbstractAsyncContextManager">AbstractAsyncContextManager</span></span><span class="p">[</span>
</span><span id="__span-0-2">    <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span>
</span><span id="__span-0-3">        <span class="n"><span title="anyio.streams.memory.MemoryObjectReceiveStream">MemoryObjectReceiveStream</span></span><span class="p">[</span>
</span><span id="__span-0-4">            <span class="n"><span title="mcp.types.JSONRPCMessage">JSONRPCMessage</span></span> <span class="o">|</span> <span class="n"><span title="Exception">Exception</span></span>
</span><span id="__span-0-5">        <span class="p">],</span>
</span><span id="__span-0-6">        <span class="n"><span title="anyio.streams.memory.MemoryObjectSendStream">MemoryObjectSendStream</span></span><span class="p">[</span><span class="n"><span title="mcp.types.JSONRPCMessage">JSONRPCMessage</span></span><span class="p">],</span>
</span><span id="__span-0-7">    <span class="p">]</span>
</span><span id="__span-0-8"><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Create the streams for the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-299"><span class="k">def</span><span class="w"> </span><span class="nf">create_streams</span><span class="p">(</span>
</span><span id="__span-0-300">    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-301"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AbstractAsyncContextManager</span><span class="p">[</span>
</span><span id="__span-0-302">    <span class="nb">tuple</span><span class="p">[</span>
</span><span id="__span-0-303">        <span class="n">MemoryObjectReceiveStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span> <span class="o">|</span> <span class="ne">Exception</span><span class="p">],</span>
</span><span id="__span-0-304">        <span class="n">MemoryObjectSendStream</span><span class="p">[</span><span class="n">JSONRPCMessage</span><span class="p">],</span>
</span><span id="__span-0-305">    <span class="p">]</span>
</span><span id="__span-0-306"><span class="p">]:</span>
</span><span id="__span-0-307"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create the streams for the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-308">    <span class="k">return</span> <span class="n">sse_client</span><span class="p">(</span>
</span><span id="__span-0-309">        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">],</span>
</span><span id="__span-0-310">        <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="__span-0-311">        <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="__span-0-312">        <span class="n">sse_read_timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sse_read_timeout&quot;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">5</span><span class="p">),</span>
</span><span id="__span-0-313">    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.cleanup" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">cleanup</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">cleanup</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Cleanup the SSE server with special handling for async generators.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-349"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-350"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cleanup the SSE server with special handling for async generators.&quot;&quot;&quot;</span>
</span><span id="__span-0-351">    <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_lock</span><span class="p">:</span>
</span><span id="__span-0-352">        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-353">            <span class="c1"># For SSE connections, we need to handle cleanup differently</span>
</span><span id="__span-0-354">            <span class="c1"># to avoid async generator warnings</span>
</span><span id="__span-0-355">            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
</span><span id="__span-0-356">                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="__span-0-357">                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*asynchronous generator.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-358">                <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;.*was never awaited.*&quot;</span><span class="p">)</span>
</span><span id="__span-0-359">
</span><span id="__span-0-360">                <span class="c1"># Try a quick cleanup with a short timeout</span>
</span><span id="__span-0-361">                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-362">                    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">aclose</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span id="__span-0-363">                <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
</span><span id="__span-0-364">                    <span class="c1"># Expected for SSE connections</span>
</span><span id="__span-0-365">                    <span class="k">pass</span>
</span><span id="__span-0-366">                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-367">                    <span class="c1"># Ignore any other errors during SSE cleanup</span>
</span><span id="__span-0-368">                    <span class="k">pass</span>
</span><span id="__span-0-369">                <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-0-370">                    <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-371">        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-372">            <span class="c1"># Silently ignore all errors for SSE cleanup</span>
</span><span id="__span-0-373">            <span class="k">pass</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.connect" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">connect</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">connect</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Connect to the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-101"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-102"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Connect to the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-103">    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-104">        <span class="n">transport</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_async_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_streams</span><span class="p">())</span>
</span><span id="__span-0-105">        <span class="n">read</span><span class="p">,</span> <span class="n">write</span> <span class="o">=</span> <span class="n">transport</span>
</span><span id="__span-0-106">        <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_stack</span><span class="o">.</span><span class="n">enter_async_context</span><span class="p">(</span><span class="n">ClientSession</span><span class="p">(</span><span class="n">read</span><span class="p">,</span> <span class="n">write</span><span class="p">))</span>
</span><span id="__span-0-107">        <span class="k">await</span> <span class="n">session</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</span><span id="__span-0-108">        <span class="bp">self</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
</span><span id="__span-0-109">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-110">        <span class="c1"># Only log connection errors at debug level</span>
</span><span id="__span-0-111">        <span class="n">error_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="__span-0-112">        <span class="n">error_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="__span-0-113">        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;connection&quot;</span> <span class="ow">in</span> <span class="n">error_str</span> <span class="ow">or</span> 
</span><span id="__span-0-114">            <span class="s2">&quot;refused&quot;</span> <span class="ow">in</span> <span class="n">error_str</span> <span class="ow">or</span> 
</span><span id="__span-0-115">            <span class="s2">&quot;taskgroup&quot;</span> <span class="ow">in</span> <span class="n">error_str</span> <span class="ow">or</span>
</span><span id="__span-0-116">            <span class="n">error_type</span> <span class="o">==</span> <span class="s2">&quot;ExceptionGroup&quot;</span><span class="p">):</span>
</span><span id="__span-0-117">            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected connection error during MCP server init: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-118">        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-119">            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error initializing MCP server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-120">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</span><span id="__span-0-121">        <span class="k">raise</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.list_tools" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">list_tools</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">list_tools</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="mcp.Tool">Tool</span></span><span class="p">]</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>List the tools available on the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-123"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">list_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">MCPTool</span><span class="p">]:</span>
</span><span id="__span-0-124"><span class="w">    </span><span class="sd">&quot;&quot;&quot;List the tools available on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-125">    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
</span><span id="__span-0-126">        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Server not initialized. Make sure you call `connect()` first.&quot;</span><span class="p">)</span>
</span><span id="__span-0-127">
</span><span id="__span-0-128">    <span class="c1"># Return from cache if caching is enabled, we have tools, and the cache is not dirty</span>
</span><span id="__span-0-129">    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_tools_list</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirty</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span><span class="p">:</span>
</span><span id="__span-0-130">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span>
</span><span id="__span-0-131">
</span><span id="__span-0-132">    <span class="c1"># Reset the cache dirty to False</span>
</span><span id="__span-0-133">    <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirty</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-134">
</span><span id="__span-0-135">    <span class="c1"># Fetch the tools from the server</span>
</span><span id="__span-0-136">    <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">list_tools</span><span class="p">())</span><span class="o">.</span><span class="n">tools</span>
</span><span id="__span-0-137">    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools_list</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.call_tool" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">call_tool</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">call_tool</span><span class="p">(</span>
</span><span id="__span-0-2">    <span class="n">tool_name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="__span-0-3"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="mcp.types.CallToolResult">CallToolResult</span></span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Invoke a tool on the server.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-139"><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CallToolResult</span><span class="p">:</span>
</span><span id="__span-0-140"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invoke a tool on the server.&quot;&quot;&quot;</span>
</span><span id="__span-0-141">    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">:</span>
</span><span id="__span-0-142">        <span class="k">raise</span> <span class="n">UserError</span><span class="p">(</span><span class="s2">&quot;Server not initialized. Make sure you call `connect()` first.&quot;</span><span class="p">)</span>
</span><span id="__span-0-143">
</span><span id="__span-0-144">    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">call_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="cai.sdk.agents.mcp.server.MCPServerSse.invalidate_tools_cache" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">invalidate_tools_cache</span>


</h4>
<div class="language-python doc-signature highlight"><pre><span></span><code><span id="__span-0-1"><span class="nf">invalidate_tools_cache</span><span class="p">()</span>
</span></code></pre></div>

    <div class="doc doc-contents ">

        <p>Invalidate the tools cache.</p>


            <details class="quote">
              <summary>Source code in <code>src/cai/sdk/agents/mcp/server.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">97</span>
<span class="normal">98</span>
<span class="normal">99</span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-97"><span class="k">def</span><span class="w"> </span><span class="nf">invalidate_tools_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-98"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invalidate the tools cache.&quot;&quot;&quot;</span>
</span><span id="__span-0-99">    <span class="bp">self</span><span class="o">.</span><span class="n">_cache_dirty</span> <span class="o">=</span> <span class="kc">True</span>
</span></code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.code.select", "navigation.path", "navigation.sections", "navigation.expand", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>